// backend/prisma/schema.prisma

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

// --- ENUMS ---

enum Role {
  USER
  ADMIN
}

enum SubscriptionTier {
  FREE
  PRO
  TEAM
}

enum SubscriptionStatus {
  active
  canceled
  past_due
  incomplete
  trialing
}

// --- MODELS ---

model User {
  id        String  @id @default(uuid())
  email     String  @unique
  password  String? // Nullable for OAuth users
  firstName String
  lastName  String?
  avatar    String?
  role      Role    @default(USER)
  isActive  Boolean @default(true)

  // Subscription Fields
  tier                 SubscriptionTier    @default(FREE)
  stripeCustomerId     String?             @unique
  stripeSubscriptionId String?             @unique
  subscriptionStatus   SubscriptionStatus?
  subscriptionEndsAt   DateTime?

  // JSON preferences (theme, notifications, etc.)
  preferences Json?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  notes Note[]

  @@map("users")
}

model Note {
  id      String @id @default(uuid())
  title   String
  content Json   @default("{}") // Stores the editor content as JSON

  isArchived Boolean @default(false)
  isDeleted  Boolean @default(false)
  isShared   Boolean @default(false) // <--- This was the missing field causing the error

  userId String
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("notes")
}